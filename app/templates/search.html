<html>

    <head>
		<script type="text/javascript" src="https://d3js.org/d3.v5.min.js"> </script>
        <link rel="stylesheet" type="text/css" href="/static/shared.css">

		{% if queryType == "movie" %}
			<link rel="stylesheet" type="text/css" href="/static/main_MB.css">
			<title>The Book Was Better.</title>
		{% else %}
			<link rel="stylesheet" type="text/css" href="/static/main_BM.css">
			<title>The Movie Was Better?</title>
		{% endif %}

		<link rel="stylesheet" type="text/css" href="/static/awesomplete/awesomplete.css">
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
		<script src="/static/awesomplete/awesomplete.js" async></script>
	</head>

	<script type="text/javascript">
		function useSpec(queryType, query){
			window.location.href = "/?queryType=" + queryType + "&query=" + query + "&spec=True";
		}
		function useInspiration(queryType, insp){
			window.location.href = "/?queryType=" + queryType + "&query=" + insp + "&keyword=&popSlide=0";
		}
		function invertQueryType(queryType, query){
			if(query === 'None'){
				query = "";
			}	
			if(queryType === 'book'){
				window.location.href = "/?queryType=movie&query=";
			}
			else{
				window.location.href = "/?queryType=book&query=";
			}
		}
        function escapeString(string){
            return string.replace(",", "\,").replace("'", "\'");
        }
	</script>

	<body>
        <button type = "button" id="invertButton" class = "styleButton" style="font-size: 20px;" onclick='invertQueryType("{{queryType}}", "{{query}}")'>â‡†</button>

        <div id = "Header" style="padding-top: 50px">
			{% if queryType == "movie" %}
                <h1><a class="linkNoStyle" href="/">The Book Was Better.</a></h1>
                <h2>Literature recommendations for the age of film.</h2>
			{% else %}
				<h1><a class="linkNoStyle" href="/?queryType=book&query=">The Movie Was Better?</a></h1>
				<h2>Film recommendations for the post-literature age.</h2>
			{% endif %}
			
			
			<form id="inForm">
  				<div class = "inFormSearch">
                    {% if pastSearch and spec == "False" %}
                        <input class="awesomplete" autofocus id = "inFormSearchBar" name="query" size="50" value="{{ pastSearch }}" list="validInputList" />
                    {% else %}
                        {% if queryType == "movie" %}
  					        <input class="awesomplete" autofocus id = "inFormSearchBar" name="query" size="50" placeholder="Find book recommendations based on a movie you like" list="validInputList" />
                        {% else %}
                            <input class="awesomplete" autofocus id = "inFormSearchBar" name="query" size="50" placeholder="Find movie recommendations based on a book you like" list="validInputList" />
                        {% endif %}
                    {% endif %}
                    <datalist id="validInputList">
                        {% for query in validQueries %}
                            <option>{{query}}</option>
                        {% endfor %}
                    </datalist>
  					
  					<div id = "tinyLine"></div>

  					{% if pastKeyword and spec == "False" %}
                        <input type="text" id = "inFormKeyBar" name="keyword" value="{{pastKeyword}}"/>
                    {% else %}
  						<input type="text" id = "inFormKeyBar" name="keyword" placeholder="Keyword"/>
  					{% endif %}

  					<input type="hidden" id="queryType" name="queryType" value={{queryType}}/>
  				</div>
  				<div>
                    <br>
                    Relevance&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Popularity<br>
  					{% if pastPop and spec == "False" %}
                        <input type="range" name="popSlide" id="slider" min="0" max="1" value="{{pastPop}}" step=".01">
                    {% else %}
  						<input type="range" name="popSlide" id="slider" min="0" max="1" value=".5" step=".01">
  					{% endif %}
  				</div>
  				<div>
                    <br>
  					<button type="submit" id = "searchButton" class = "styleButton" value="Search!"><i class="fa fa-search"></i></button>
  				</div>
        	</form>
		</div>

		<div id = "Output">
        	{% if isHomeScreen == True %}
                {% if queryType == "movie" %}
        		    <p>Not much of a movie buff?<br>Here's some inspiration!</p>
                {% else %}
                    <p>Not much of a bookworm?<br>Here's some inspiration!</p>
                {% endif %}
        		{% for i in inspiration %}
        			<button type = "button" class = "styleButton" onclick="useInspiration('{{queryType}}', '{{i[1]}}'.replace('%20','+'))">{{i[0]}}</button><br>
        		{% endfor %}
        	{% elif spec == "False" %}
                {% if failedSearch %}
                    <h2>{{ failedSearch }}</h2>
                {% endif %}
        		{% if output %}
		            {% for o in output %}
		            	{% if queryType == "movie" %}
		            		<div class = "outputCard" onclick='useSpec("{{queryType}}",escapeString("{{o.title}}"))'>
			            		{% if o["img"]%}
				            		<div class = "outputCardImg">
				            			<img src="{{o['img']}}" width="100%" height="100%" style="border-radius:10px;">
				            		</div>

				            		<div class = "outputCardText" style= "width:80%;">
				            	{% else %}
				            		<div class = "outputCardText" style= "width:100%;">
			            		{% endif %}
				                	<p class = "title">{{o["title"]}}</p>
				                	<p class = "author">{{o["author"]}}</p>
				                	<p><i>Similarity Score</i>: {{o["simScore"]}}</p>
				                	<p> {% for trope in o["tropes"] %}
				                		{{trope[0]}}
				                	{% endfor %}</p>
			                	</div>
			                </div> <br>
		                {% endif %}
		                {% if queryType == "book" %}
			            	<div class = "outputCard" onclick='useSpec("{{queryType}}",escapeString("{{o.title}}"))'>

			         			{% if o["img"]%}
				            		<div class = "outputCardImg">
				            			<img src="{{o['img']}}" width="100%" height="100%" style="border-radius:10px;">
				            		</div>

				            		<div class = "outputCardText" style= "width:80%;">
				            	{% else %}
				            		<div class = "outputCardText" style= "width:100%;">
			            		{% endif %}
				                	<p class = "title">{{o["title"]}}</p>
				                	<p><i>Similarity Score</i>: {{o["simScore"]}}</p>
				                	<p> {% for trope in o["tropes"] %}
				                		{{trope[0]}}
				                	{% endfor %}</p>
				                </div>
			                </div> <br>
		                {% endif %}
		            {% endfor %}
	        	{% endif %}
	        {% else %}
	        	<div class = "specCard">
                    <!-- Title -->
                    <p class = "title">{{spec["title"]}}</p>

                    <!-- Author details -->
                    {% if queryType == "movie" %}
                        {% if spec["author"] or spec["year"]%}
                            <p class = "author">
                                {% if spec["author"]%}
                                    {{spec["author"]}}
                                {% endif %}
                                {% if spec["year"]%}
                                    ({{spec["year"]}})
                                {% endif %}
                            </p>
                        {% endif %}
                    {% else %}
                        {% if spec["year"]%}
                            <p class = "author">
                                ({{spec["year"]}})
                            </p>
                        {% endif %}
                    {% endif %}

                    <!-- Image -->
                    {% if spec["img"]%}
                        <div class = "outputCardImg">
                            <img src="{{spec['img']}}" width="100%" height="100%" style="border-radius:10px;">
                        </div>
                        <br><br>
                    {% endif %}

                    <!-- Rating -->
                    {% if queryType == "movie" %}
		        		{% if spec["rating"]%}
		        			<img src="/static/rating_icons/{{spec['rating']}}B.png" height="20">
                        {% endif %}
                    {% else %}
                        {% if spec["rating"]%}
                            <img src="/static/rating_icons/{{spec['rating']}}Y.png" height="20">
                        {% endif %}
                    {% endif %}

                    <!-- Summary -->

                    {% if spec["summary"]%}
                        <br>
                        <h3><p><i>Summary</i></p></h3>
                        {% for para in spec["summary"] %}
                            <p class="summaryText">{{ para }}</p>
                        {% endfor %}
                    {% endif %}

                    <!-- Tropes -->
                    <h3><p><i>Tropes</i></p></h3>
                    {% for trope in spec["tropes"] %}
                        <p class="trope">{{trope[0]}}<span class="tropeText">{{trope[1]}}</span></p>
                    {% endfor %}

                    <!-- Reviews -->
                    {% if spec["reviews"]%}
                        <h3><p><i>Reviews</i><br></p></h3>
                        {% if queryType == "movie" %}
                            {% for review in spec["reviews"] %}
                                <p>{{review['text'] | safe}} <br>(<img src="/static/rating_icons/{{review['rating']}}B.png" height="12">)</p>
                            {% endfor %}
                        {% else %}
                            {% for review in spec["reviews"] %}
                                <p>{{review['text'] | safe}} <br>(<img src="/static/rating_icons/{{review['rating']}}Y.png" height="12">)</p>
                            {% endfor %}
                        {% endif %}
                    {% endif %}

                    <form>
                        <input type="button" class="styleButton" value="Go back" onclick="history.back()">
                    </form>
	        	</div>
        	{% endif %}
		</div>
	</body>
</html>